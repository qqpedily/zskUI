/**
 * Created by whw-apple on 16/8/1.
 */

$(function() {
	if($(".close").length > 0) {
		$(".close").click(function() {
			$(".popup").hide();
			$("body").css({
				"overflow": "auto"
			});
		});
	}
	$(".submit").click(function() {
		$(".popup").hide();
		$("body").css({
			"overflow": "auto"
		});
	});
	if($(".add_cont").length > 0 || $(".edit_cont").length > 0) {
		$("button.add").click(function() {
			$(".popup.add_cont").show();
			$("body").css({
				"overflow": "hidden"
			});
		});
		$("button.edit").click(function() {
			$(".popup.edit_cont").show();
			$("body").css({
				"overflow": "hidden"
			});
		});
	}
	if($(".admin_nav ul.sub_list li").hasClass("active")) {
		$(this).parent().parent().addClass("active");
	} else {
		$(this).parent().parent().removeClass("active");
	}
	if($(".admin_nav").length > 0) {
		nav("admin_nav");
	}
	if($(".user_nav").length > 0) {
		nav("user_nav");
	}
	tabs(".tabs");
	if($(".cont_list").length > 0) {
		$.ajax({
			type: "GET",
			url: "../api/cont_list.json",
			cache: false,
			dataType: "json",
			success: function(data) {
				console.log(data.data);
				var html = "";
				$(data.data).each(function() {
					html += "<option id='" + this.id + "'>" + this.name + "</option>";
				})
				$(".cont_list").append(html);
			}
		});
	}

	// onclick="TitHide()" >个人工作室管理

	$(".footer").html('<p>Copyright <span class="big"> &copy; </span>复旦大学上海医学院机构知识库  网站总浏览量：<span class="font_red">5490345</span></p>');
	//跳转后台路径
	/*var logout_html = '<li id="login"><a href="javascript:void(0);">登录</a></li><li id="reg"><a href="javascript:void(0);">注册</a></li><li id="help"><a href="javascript:void(0);">帮助</a></li>';
	var login_html = '<li>欢迎：<li><a href="/scholar_details.html"><span class="avatar login"><img src="./img/pic_1.jpg"></span>&nbsp;&nbsp;&nbsp;&nbsp;李唐</a></li><li id="ack" onclick="ack()"  name="ia"><a href="./index.html#/UserHome" >个人工作室管理</a></li><li><a href="http://47.92.90.65:8888/?UserId=CD1F7BC3-32CD-4DC4-82EA-00044788C86E&UserName=戎兰" target="_blank">后台管理</a></li><li id="logout"><a href="javascript:void(0);">退出</a></li>';
	var login_status = window.localStorage.getItem("isLogin");
	var login_form = '<div class="popup login_form">' +
		'<div class="mask"></div>' +
		'<div class="popup_cont  normal">' +
		'<h2><span class="close"><i class="fa fa-times"></i></span> 登录</h2>' +
		'<div class="join_form">' +
		'<div class="input_div">' +
		'<label>用户名</label>' +
		'<input type="text">' +
		'</div>' +
		'<div class="input_div">' +
		'<label>密码</label>' +
		'<input type="password">' +
		'</div>' +
		'<div class="input_btn">' +
		'<label>&nbsp;</label>' +
		'<button type="button" class="btn btn_red btn_login">登录</button>' +
		'</div>' +
		'</div>' +
		'</div>' +
		'</div>';
	var reg_form = '<div class="popup reg_form">' +
		'<div class="mask"></div>' +
		'<div class="popup_cont normal">' +
		'<h2><span class="close"><i class="fa fa-times"></i></span> 注册</h2>' +
		'<div class="join_form inline_form">' +
		'<div class="input_div">' +
		'<label>电子邮件：</label>' +
		'<input name="" type="text" value="">' +
		'</div>' +
		'<div class="input_div">' +
		'<label>姓：</label>' +
		'<input name="" type="text" value="" class="inline_input" placeholder="中文"><input name="" type="text" value="" class="inline_input" placeholder="拼音">' +
		'</div>' +
		'<div class="input_div">' +
		'<label>名：</label>' +
		'   <input name="" type="text" value="" class="inline_input" placeholder="中文"><input name="" type="text" value="" class="inline_input" placeholder="拼音">' +
		'</div>' +
		'<div class="input_div">' +
		'<label>&nbsp;</label>' +
		'<div class="font_red">多汉字名的拼音中间用空格分开</div>' +
		'</div>' +
		'<div class="input_div">' +
		'<label>单位：</label>' +
		'<select>' +
		'<option selected>请选择单位</option>' +
		'</select>' +
		'</div>' +
		'<div class="input_div">' +
		'<label>部门：</label>' +
		'<select>' +
		'<option selected>请选择部门</option>' +
		'</select>' +
		'</div>' +
		'<div class="input_div">' +
		'<label>职称：</label>' +
		'<select>' +
		'<option selected>请选择职称</option>' +
		'</select>' +
		'</div>' +
		'<div class="input_div">' +
		'<label>身份：</label>' +
		'<select>' +
		'<option selected>请选择身份</option>' +
		'</select>' +
		'</div>' +
		'<div class="input_div">' +
		'<label>电话：</label>' +
		'<input type="text" name="">' +
		'</div>' +
		'<div class="input_div">' +
		'<label>密码：</label>' +
		'<input type="password" name="">' +
		'</div>' +
		'<div class="input_div">' +
		'<label>再输入一遍：</label>' +
		'<input type="password" name="">' +
		'</div>' +
		'<div class="btn_div">' +
		'<label>&nbsp;</label>' +
		'<button class="btn btn_red btn_reg">注册</button>' +
		'</div>' +
		'</div>' +
		'</div>' +
		'</div>';
*/
	/*if(login_status == true || login_status == "1") {
		$(".nav .right_cont").html(login_html);
		$("#logout").click(function() {
			window.localStorage.removeItem("isLogin");
			window.location.href = './index.html#/Home';
		});
	} else if(login_status != null || login_status == false || login_status == undefined) {
		$(".nav .right_cont").html(logout_html);
		$("body").append(login_form);
		$("body").append(reg_form);
		$(".btn_login").click(function() {
			$(".login_form").hide();
			window.localStorage.setItem("isLogin", "1");
			window.location.href = './index.html';
		});
		$(".btn_reg").click(function() {
			$(".reg_form").hide();
			window.localStorage.setItem("isLogin", "1");
			window.location.href = './index.html';
		});
	}*/

	$("#login").click(function() {
		$(".login_form").show();
		$(".close").click(function() {
			$(".login_form").hide();
		});
	});
	$("#reg").click(function() {
		$(".reg_form").show();
		$(".close").click(function() {
			$(".reg_form").hide();
		});
	});

	function nav(name) {
		$.ajax({
			type: "GET",
			url: "../api/" + name + ".json",
			cache: false,
			dataType: "json",
			success: function(data) {
				var nav = data.data
				var filename = location.href;
				subname = filename.substr(filename.lastIndexOf('/') + 1);
				var reg = subname.split('_', 1);
				var reg2 = subname.split('_', 2);
				var subname2 = reg2[0] + "_" + reg2[1] + ".html";

				$(nav).each(function() {
					var html = "";
					// console.log(this.submenu);
					html += '<li id="' + this.id + '"><a href="' + this.url + '">' + this.name + '<i class="fa fa-angle-down"></a></i>';

					if(this.submenu != null || this.submenu != undefined) {
						html += '<ul class="sub_list">';
						$(this.submenu).each(function() {
							// console.log(this.num);
							var name = this.name;
							var url = this.url;
							var num = this.num;
							if(num != null || num != undefined) {
								if(url == subname || url == subname2) {
									html += '<li class="active"><a href="' + url + '">' + name + num + '</a></li>';
								} else {
									html += '<li><a href="' + url + '">' + name + num + '</a></li>';
								}
							}
						});
						html += "</li></ul>";
					} else {
						$(this.submenu).each(function() {
							// console.log(this.num);
							var name = this.name;
							var url = this.url;

							if(url == subname || url == subname2) {
								html += '<li class="active"><a href="' + url + '">' + name + '</a></li>';
							} else {
								html += '<li><a href="' + url + '">' + name + '</a></li>';
							}
						});
					}
					$("." + name + " ul.main_list").append(html);
					// if (reg[0] == this.id){
					//     $('#'+this.id).addClass("active").find(".sub_list").show();
					// }else{
					//     $('#'+this.id).removeClass("active");
					// }
					// $("." + name + " ul.main_list li a").click(function () {
					//     $(this).next("ul.sub_list").show();
					// });
				});
			},
			error: function(e) {
				console.log('Error!', e);
			}
		});
	}
})

function tabs(tabarea) {
	$(tabarea + " .tab_list .tab").each(function() {
		$(this).click(function() {
			$(this).addClass("active").siblings().removeClass("active");
			var c_name = $(this).attr("id");
			$(tabarea + " .tab_cont." + c_name).show().siblings(".tab_cont").hide();
		});
	});
}

function IndexDemo(str2) {
	var str1 = window.location.pathname;
	var s = str1.indexOf(str2);
	return(s);
}
// get url param
(function($) {
	$.getUrlParam = function(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
		var r = window.location.search.substr(1).match(reg);
		if(r != null) return unescape(r[2]);
		return null;
	}
})(jQuery);

$(function() {
	$('.l_dmain_list_li').click(function() {
		$(this).children('ul').show().parents('li').siblings().children('ul').hide();
		$(this).children('a').addClass('action').parents('li').siblings().children('a').removeClass('action');
	});
	$('.l_dmain_list>li>ul>li').click(function() {
		$(this).addClass('action').siblings('.action').removeClass('action');
	});
	$(".item_list li").click(function() {
		window.open("scholars_in_our_school_1.html", "blank");
	});
	$("a").mouseenter(function() {
		$(this).css("cursor", "pointer");
	}).mouseout(function() {
		$(this).css("cursor", "default");
	});
})

function conlist() {
	var a = document.getElementById("aaa");
	a.style.display = "block";
}

function UpladFile() {
	var fileObj = document.getElementById("file").files[0]; // 获取文件对象
	var FileController = "http://192.168.199.239:8013/Test/SavaFiles"; // 接收上传文件的后台地址
	// FormData 对象
	var form = new FormData();
	form.append("author", "hooyes"); // 可以增加表单数据
	form.append("file", fileObj); // 文件对象
	// XMLHttpRequest 对象
	var xhr = new XMLHttpRequest();
	xhr.open("post", FileController, true);
	xhr.onload = function() {
		alert("上传完成!");
	};
	xhr.send(form);
}

//ain ay am ack
function ack() {
	$("#ain").removeClass("active");
	$("#ay").removeClass("active");
	$("#am").removeClass("active");
	$("#ack").addClass("active");
}

function am() {
	$("#ain").removeClass("active");
	$("#ay").removeClass("active");
	$("#am").addClass("active");
	$("#ack").removeClass("active");
}

function ay() {
	$("#ain").removeClass("active");
	$("#ay").addClass("active");
	$("#am").removeClass("active");
	$("#ack").removeClass("active");
}

function ain() {
	$("#ain").addClass("active");
	$("#ay").removeClass("active");
	$("#am").removeClass("active");
	$("#ack").removeClass("active");
}

function mos(e) {
	$(e.target).children('div.downLoads').css('display', 'block')
}

function mon(e) {
	$(e.target).children('div').css('display', 'none')
}